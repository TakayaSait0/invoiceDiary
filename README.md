# 請求書ジェネレーター

ログイン不要で使える請求書作成・管理アプリケーション。LocalStorageまたはGoogleスプレッドシートにデータを保存できます。

## 🎯 主な機能

- ✅ **ログイン不要**ですぐに使える
- ✅ 請求書の作成・編集・削除
- ✅ **ブラウザ内（LocalStorage）に自動保存**
- ✅ **Googleスプレッドシートへの自動保存（オプション）**
- ✅ PDF出力機能
- ✅ Excel/CSV エクスポート
- ✅ 会社情報・ロゴの管理
- ✅ 消費税の自動計算
- ✅ 請求書の検索機能
- ✅ レスポンシブデザイン

## 💾 データ保存方法（選択可能）

### 方法1: LocalStorageのみ（デフォルト）
- ログイン不要
- インターネット接続不要
- ブラウザ内にデータを保存
- Excel/CSVでエクスポート可能

### 方法2: LocalStorage + Googleスプレッドシート
- ログイン不要（Apps Script使用）
- 両方に自動保存
- 複数デバイスから同じデータにアクセス可能
- スプレッドシートで分析・編集可能
- **設定方法は [APPS_SCRIPT_SETUP.md](APPS_SCRIPT_SETUP.md) を参照**

## 技術スタック

- HTML/CSS/JavaScript（バニラJS）
- Google Apps Script（オプション）
- SheetJS（Excel/CSV出力）
- jsPDF（PDF生成）

## 🚀 クイックスタート

### ローカルサーバーの起動

HTMLファイルを直接開くとCORSエラーが発生するため、ローカルサーバーを起動する必要があります。

**Pythonを使う場合:**
```bash
# Python 3
python -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000
```

**Node.jsを使う場合:**
```bash
# http-serverをインストール（初回のみ）
npm install -g http-server

# サーバー起動
http-server -p 8000
```

**VS Codeを使う場合:**
- Live Server拡張機能をインストールして起動

### アプリケーションを開く

ブラウザで以下にアクセス:
```
http://localhost:8000
```

## 📖 使い方

### 会社情報の設定（最初に設定）

1. 「設定」タブをクリック
2. 会社情報を入力:
   - 会社名
   - 住所
   - 電話番号
   - メールアドレス
   - 会社ロゴ（画像アップロード）
   - 銀行口座情報
3. 「設定を保存」をクリック

### 請求書の作成

1. 「新規作成」ボタンをクリック
2. 請求書情報を入力:
   - 請求書番号（自動生成、編集可能）
   - 発行日・支払期限
   - 顧客情報
   - 品目（複数行追加可能）
3. 「保存」ボタンでGoogleスプレッドシートに保存

### PDFの出力

1. 「プレビュー」ボタンでプレビュー表示
2. プレビュー画面で「PDFダウンロード」をクリック
3. または請求書一覧から「PDF」ボタンをクリック

### Excel/CSVエクスポート

1. ホーム画面の「Excelエクスポート」または「CSVエクスポート」ボタンをクリック
2. すべての請求書データがダウンロードされます
3. Excelで開いて編集・分析可能

### Googleスプレッドシート連携（オプション）

ログイン不要でGoogleスプレッドシートに自動保存する方法：

1. 「設定」タブを開く
2. 「Googleスプレッドシート連携」セクションを見つける
3. 「セットアップ手順を見る」リンクをクリック
4. **[APPS_SCRIPT_SETUP.md](APPS_SCRIPT_SETUP.md)** の手順に従ってセットアップ
5. Apps Script URL を入力して保存

**メリット:**
- 複数のデバイスから同じデータにアクセス
- スプレッドシートで直接編集・分析
- 自動バックアップ

### 請求書の編集・削除

- 請求書一覧から「編集」ボタンで編集
- 「削除」ボタンで削除（確認ダイアログ表示）

### 請求書の検索

- 検索ボックスに請求書番号または顧客名を入力
- リアルタイムで絞り込み

## プロジェクト構造

```
invoiceGenerator/
├── index.html              # メインHTML
├── AppsScript.gs          # Google Apps Script（スプレッドシート側）
├── APPS_SCRIPT_SETUP.md   # Apps Script セットアップガイド
├── README.md              # このファイル
├── css/
│   └── style.css         # スタイルシート
└── js/
    ├── config.js         # 設定ファイル
    ├── storage.js        # LocalStorage + Apps Script連携
    ├── export.js         # Excel/CSVエクスポート
    ├── pdf.js            # PDF生成
    └── app.js            # メインアプリケーションロジック
```

## Googleスプレッドシートの構造（連携時）

Apps Script連携を設定した場合、スプレッドシートには以下の3つのシートが自動作成されます:

### 1. 請求書一覧
請求書の基本情報（請求書番号、発行日、顧客名、合計金額など）

### 2. 品目詳細
各請求書の品目明細（品目名、数量、単価、金額）

### 3. 会社情報
発行者の会社情報とロゴデータ

## トラブルシューティング

### データが保存されない
- ブラウザのLocalStorageが有効か確認
- プライベートモード/シークレットモードでは保存されない場合があります
- ブラウザのストレージ容量を確認

### Googleスプレッドシートに保存されない（連携時）
- Apps Script URLが正しく設定されているか確認
- Apps Scriptのデプロイ設定を確認（「アクセスできるユーザー」が「全員」か）
- **詳しくは [APPS_SCRIPT_SETUP.md](APPS_SCRIPT_SETUP.md) のトラブルシューティングを参照**

### PDFが文字化けする
- jsPDFは日本語フォントのサポートが限定的です
- 英数字と基本的な日本語は表示されます

### Excel/CSVエクスポートができない
- ブラウザでダウンロードがブロックされていないか確認
- ポップアップブロッカーを無効にしてみる

### CORSエラーが発生する
- ローカルサーバー経由でアクセスしているか確認
- `file://` プロトコルでは一部の機能が動作しません

## カスタマイズ

### 請求書番号のフォーマット変更
`js/config.js` の以下を変更:
```javascript
INVOICE_PREFIX: 'INV',           // プレフィックス
INVOICE_NUMBER_LENGTH: 4,        // 桁数
```

### デフォルトの消費税率
```javascript
DEFAULT_TAX_RATE: 10,            // 10%
```

### 支払期限のデフォルト日数
```javascript
DEFAULT_DUE_DAYS: 30,            // 30日後
```

## セキュリティに関する注意

### LocalStorageのみの場合
- データはブラウザ内に保存されます
- 他の人からは見えません
- 定期的にExcel/CSVでバックアップを取ることを推奨

### Googleスプレッドシート連携の場合
- Apps Script URLは知っている人全員が書き込めます
- 重要なデータの場合は、セキュリティ強化を検討してください
- **詳しくは [APPS_SCRIPT_SETUP.md](APPS_SCRIPT_SETUP.md) の高度な設定を参照**

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

問題が発生した場合は、以下を確認してください:
- ブラウザのコンソールでエラーメッセージを確認
- Google Cloud Consoleの設定を再確認
- ブラウザのキャッシュをクリア

## 今後の拡張予定

- [x] ログイン不要での利用（完了）
- [x] Excel/CSV エクスポート（完了）
- [x] Googleスプレッドシート連携（完了）
- [ ] 複数の消費税率に対応（品目ごとに設定）
- [ ] テンプレート機能
- [ ] 定期請求書の自動生成
- [ ] 多言語対応
- [ ] ダークモード
