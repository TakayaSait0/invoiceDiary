# 請求書ジェネレーター - セットアップガイド

このガイドでは、請求書ジェネレーターを使い始めるまでの手順を詳しく説明します。

## 🚀 クイックスタート

### ステップ1: ローカルサーバーの起動

ターミナルで以下のコマンドを実行してください：

```bash
cd /Users/saitotakaya/claude\ code\ test/invoiceGenerator
python3 -m http.server 8000
```

ブラウザで以下にアクセス：
```
http://localhost:8000
```

### ステップ2: Google Cloud Consoleの設定

アプリケーションを使用するには、Google Cloud ConsoleでAPIの設定が必要です。

---

## 📋 詳細なセットアップ手順

### 1. Google Cloud Consoleでプロジェクトを作成

1. **Google Cloud Consoleにアクセス**
   - ブラウザで https://console.cloud.google.com/ を開く
   - Googleアカウントでログイン

2. **新しいプロジェクトを作成**
   - 画面上部の「プロジェクトを選択」をクリック
   - 「新しいプロジェクト」をクリック
   - プロジェクト名: `invoice-generator`（任意）
   - 「作成」をクリック

3. **プロジェクトが作成されるまで待つ**
   - 通知を確認し、作成されたプロジェクトを選択

---

### 2. Google Sheets APIを有効化

1. **APIライブラリにアクセス**
   - 左側のメニューから「APIとサービス」→「ライブラリ」を選択

2. **Google Sheets APIを検索**
   - 検索ボックスに「Google Sheets API」と入力
   - 検索結果から「Google Sheets API」をクリック

3. **APIを有効化**
   - 「有効にする」ボタンをクリック

4. **Google Drive APIも有効化**
   - 同様に「Google Drive API」を検索して有効化

---

### 3. OAuth 2.0 クライアントIDの作成

1. **認証情報ページにアクセス**
   - 左側のメニューから「APIとサービス」→「認証情報」を選択

2. **OAuth同意画面の設定**
   - 「OAuth同意画面」タブをクリック
   - User Type: **外部** を選択して「作成」
   - アプリ情報を入力:
     - アプリ名: `請求書ジェネレーター`
     - ユーザーサポートメール: あなたのメールアドレス
     - デベロッパーの連絡先情報: あなたのメールアドレス
   - 「保存して次へ」をクリック
   - スコープは設定不要、「保存して次へ」
   - テストユーザーは設定不要、「保存して次へ」
   - 「ダッシュボードに戻る」をクリック

3. **認証情報を作成**
   - 「認証情報」タブに戻る
   - 画面上部の「+ 認証情報を作成」をクリック
   - 「OAuth 2.0 クライアントID」を選択

4. **アプリケーションの種類を選択**
   - アプリケーションの種類: **ウェブアプリケーション**
   - 名前: `請求書ジェネレーター Web Client`

5. **承認済みのJavaScript生成元を追加**
   - 「承認済みのJavaScript生成元」の「+ URIを追加」をクリック
   - 以下のURIを追加:
     ```
     http://localhost:8000
     ```
   - さらに追加（別のポートを使う場合）:
     ```
     http://localhost
     http://127.0.0.1:8000
     ```

6. **承認済みのリダイレクトURIは設定不要**
   - このアプリケーションでは不要です

7. **作成をクリック**
   - 「作成」ボタンをクリック

8. **クライアントIDをコピー**
   - ポップアップが表示されます
   - 「クライアントID」をコピー（後で使用します）
   - 形式: `xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com`

---

### 4. アプリケーションにクライアントIDを設定

1. **config.jsを編集**
   - エディタで `js/config.js` を開く

2. **クライアントIDを貼り付け**
   - 以下の行を見つける:
   ```javascript
   GOOGLE_CLIENT_ID: 'YOUR_CLIENT_ID_HERE.apps.googleusercontent.com',
   ```

   - コピーしたクライアントIDに置き換える:
   ```javascript
   GOOGLE_CLIENT_ID: 'あなたのクライアントID.apps.googleusercontent.com',
   ```

3. **ファイルを保存**

---

### 5. アプリケーションを起動

1. **ローカルサーバーが起動していることを確認**
   ```bash
   python3 -m http.server 8000
   ```

2. **ブラウザでアクセス**
   ```
   http://localhost:8000
   ```

3. **ログイン**
   - 「Googleでログイン」ボタンをクリック
   - Googleアカウントを選択
   - アクセス許可を承認（初回のみ）

   ⚠️ 「このアプリはGoogleで確認されていません」という警告が表示される場合:
   - 「詳細」をクリック
   - 「（アプリ名）に移動（安全ではないページ）」をクリック
   - これは開発中のアプリなので正常な動作です

4. **スプレッドシートの自動作成**
   - 初回ログイン時に自動的に「請求書データ」というスプレッドシートが作成されます
   - Googleドライブで確認できます

---

## 🎯 使い方

### 会社情報の設定

1. 「設定」タブをクリック
2. 会社情報を入力:
   - 会社名
   - 住所
   - 電話番号
   - メールアドレス
   - 会社ロゴ（画像をアップロード）
   - 銀行口座情報
3. 「設定を保存」をクリック

### 請求書の作成

1. 「新規作成」ボタンをクリック
2. 請求書情報を入力:
   - 請求書番号（自動生成されますが編集可能）
   - 発行日（今日の日付が自動入力）
   - 支払期限（発行日の30日後が自動入力）
   - 顧客情報
3. 品目を追加:
   - 品目名、数量、単価を入力
   - 「+ 品目を追加」で行を追加
   - 不要な行は「削除」ボタンで削除
4. 消費税率を選択（10%、8%、0%）
5. 「保存」ボタンでGoogleスプレッドシートに保存

### PDFの出力

**方法1: プレビューから**
1. 請求書作成画面で「プレビュー」をクリック
2. プレビューを確認
3. 「PDFダウンロード」をクリック

**方法2: 一覧から**
1. ホーム画面の請求書一覧から「PDF」ボタンをクリック

### 請求書の編集

1. ホーム画面の請求書一覧から「編集」ボタンをクリック
2. 内容を編集
3. 「保存」をクリック

### 請求書の削除

1. ホーム画面の請求書一覧から「削除」ボタンをクリック
2. 確認ダイアログで「OK」をクリック

---

## 🔍 トラブルシューティング

### ログインできない

**症状**: ログインボタンをクリックしても反応がない

**解決方法**:
1. ブラウザのコンソールを開く（F12キー）
2. エラーメッセージを確認
3. 以下を確認:
   - `js/config.js` にクライアントIDが正しく設定されているか
   - Google Cloud Consoleで承認済みのJavaScript生成元に `http://localhost:8000` が追加されているか
   - ブラウザのキャッシュをクリア（Cmd+Shift+R または Ctrl+Shift+R）

### 「このアプリはGoogleで確認されていません」と表示される

**症状**: ログイン時に警告が表示される

**解決方法**:
- これは正常な動作です
- 「詳細」→「（アプリ名）に移動」をクリックして続行
- 開発中のアプリなので、Google の審査を受けていないため警告が表示されます

### スプレッドシートに保存されない

**症状**: 保存ボタンを押してもエラーになる

**解決方法**:
1. Google Sheets APIが有効になっているか確認
2. 再度ログインし直す
3. ブラウザのコンソールでエラーメッセージを確認

### PDF が文字化けする

**症状**: PDFに日本語が正しく表示されない

**現状**:
- jsPDFライブラリの制限により、一部の日本語が正しく表示されない場合があります
- 英数字と基本的な日本語は表示されます

**今後の改善**:
- カスタム日本語フォントの追加を検討中

### CORSエラーが発生する

**症状**: コンソールに「CORS policy」というエラーが表示される

**解決方法**:
- HTMLファイルを直接開いていませんか？
- 必ずローカルサーバー経由でアクセスしてください:
  ```bash
  python3 -m http.server 8000
  ```
- `file://` プロトコルでは動作しません

---

## 📊 Googleスプレッドシートの確認

作成されたスプレッドシートは以下で確認できます:

1. Googleドライブにアクセス: https://drive.google.com/
2. 「請求書データ」というスプレッドシートを検索
3. スプレッドシートには3つのシートがあります:
   - **請求書一覧**: すべての請求書の情報
   - **品目詳細**: 各請求書の品目明細
   - **会社情報**: 会社情報とロゴ

直接スプレッドシートを編集することもできますが、アプリから編集することを推奨します。

---

## 🔧 カスタマイズ

### 請求書番号のフォーマット変更

`js/config.js` を編集:

```javascript
// 請求書番号のプレフィックス
INVOICE_PREFIX: 'INV',           // 'INV-0001' → 'QUOT-0001' など

// 請求書番号の桁数
INVOICE_NUMBER_LENGTH: 4,        // 4桁 → 5桁など
```

### デフォルトの消費税率

```javascript
DEFAULT_TAX_RATE: 10,            // 10% → 8% など
```

### 支払期限のデフォルト日数

```javascript
DEFAULT_DUE_DAYS: 30,            // 30日後 → 14日後など
```

---

## 📝 次のステップ

1. 会社情報を設定する
2. テスト用の請求書を1件作成してみる
3. PDFをダウンロードして確認
4. Googleスプレッドシートでデータを確認

---

## 💡 ヒント

- **自動保存**: 請求書は保存ボタンを押すまで自動保存されません
- **バックアップ**: Googleスプレッドシートに保存されるため、ブラウザを閉じてもデータは残ります
- **複数デバイス**: 同じGoogleアカウントでログインすれば、別のPCでも同じデータにアクセスできます
- **共有**: Googleスプレッドシートを他のユーザーと共有して、複数人で管理できます

---

## ❓ よくある質問

### Q: インターネット接続は必要ですか？
A: はい、Google Sheets APIを使用するためインターネット接続が必要です。

### Q: スマートフォンでも使えますか？
A: レスポンシブデザインですが、PCやタブレットでの使用を推奨します。

### Q: データは安全ですか？
A: データはあなたのGoogleアカウントのスプレッドシートに保存されます。他の人には見えません。

### Q: 何件まで請求書を作成できますか？
A: Googleスプレッドシートの制限内（通常は数千件以上）まで作成できます。

### Q: 既存のスプレッドシートを使いたい
A: 設定画面でスプレッドシートIDを入力してください。

---

## 📞 サポート

問題が解決しない場合は、以下を確認してください:

1. ブラウザのコンソール（F12）でエラーメッセージを確認
2. Google Cloud Consoleの設定を再確認
3. ブラウザのキャッシュをクリア
4. 別のブラウザで試す

それでも解決しない場合は、README.mdのトラブルシューティングセクションを参照してください。

---

**準備完了です！ http://localhost:8000 でアプリケーションをお楽しみください。**
